# Generated by Django 4.2.3 on 2023-08-23 19:16

from django.db import migrations, models


def forwards_func(apps, schema_editor):
    # We get the model from the versioned app registry;
    # if we directly import it, it'll be the wrong version
    Message = apps.get_model("bots", "Message")
    db_alias = schema_editor.connection.alias
    qs = Message.objects.using(db_alias).exclude(
        question_subject="", question_answered=""
    )
    for msg in qs:
        msg.analysis_result = {
            "user": {"subject": msg.question_subject},
            "assistant": {"answer": msg.question_answered},
        }
        msg.save()


class Migration(migrations.Migration):
    dependencies = [
        ("bots", "0030_remove_botintegration_bots_botint_fb_page_7a2a7f_idx_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="message",
            name="analysis_result",
            field=models.JSONField(
                blank=True,
                default=dict,
                help_text="The result of the analysis of this message",
            ),
        ),
        migrations.AlterField(
            model_name="message",
            name="question_answered",
            field=models.TextField(
                blank=True,
                default="",
                help_text="Bot's ability to answer given question (DEPRECATED)",
            ),
        ),
        migrations.AlterField(
            model_name="message",
            name="question_subject",
            field=models.TextField(
                blank=True,
                default="",
                help_text="Subject of given question (DEPRECATED)",
            ),
        ),
        migrations.RunPython(code=forwards_func),
    ]

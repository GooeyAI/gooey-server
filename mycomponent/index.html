<script>
    window.frameElement.parentElement.style.display = "none";
    // ----------------------------------------------------
    // Just copy/paste these functions as-is:

    function sendMessageToStreamlitClient(type, data) {
        var outData = Object.assign({
            isStreamlitMessage: true,
            type: type,
        }, data);
        window.parent.postMessage(outData, "*");
    }

    function init() {
        sendMessageToStreamlitClient("streamlit:componentReady", {apiVersion: 1});
        sendMessageToStreamlitClient("streamlit:setFrameHeight", {height: 0});
    }

    // The `data` argument can be any JSON-serializable value.
    function sendJsonToPython(value) {
        let data = {value: value, dataType: 'json'};
        sendMessageToStreamlitClient("streamlit:setComponentValue", data);
    }

    // ----------------------------------------------------
    // Now modify this part of the code to fit your needs:

    // data is any JSON-serializable value you sent from Python,
    // and it's already deserialized for you.
    let evtSource = null;
    const retryDelay = 300;

    function onDataFromPython(event) {
        if (event.data.type !== "streamlit:render") return;
        // Access values sent from Python here!
        let url = event.data.args.url;

        const fetchLoop = async () => {
            // already connected, abort
            if (evtSource && evtSource.url == url && evtSource.readyState != 2) return;
            // connect to url
            console.log('EventSource connect:', url);
            evtSource?.close();
            evtSource = new EventSource(url);
            // forward messages to python
            evtSource.onmessage = (event) => {
                sendJsonToPython(event.data);
            };
            // retry on error
            evtSource.onerror = (err) => {
                let timeout = retryDelay + Math.random() * retryDelay;
                setTimeout(fetchLoop, timeout);
            }
        }
        fetchLoop();
    }


    // Hook things up!
    window.addEventListener("message", onDataFromPython);
    init();

    /*setInterval(() => {
        sendJsonToPython(Math.random());
    }, 1000)
     */
</script>